# Caddy reverse proxy configuration for CUDA Image Processor
# Provides HTTPS for local development
# Using port 8443 (no root required)

{
	# Disable automatic HTTPS redirects (prevents trying to bind to port 80)
	auto_https disable_redirects
}

:8443 {
	tls .secrets/localhost+2.pem .secrets/localhost+2-key.pem

	@vite {
		path /@vite/* /src/* /node_modules/*
	}
	
	handle @vite {
		reverse_proxy https://localhost:3000 {
			transport http {
				tls_insecure_skip_verify
			}
		}
	}

	reverse_proxy localhost:8080

	log {
		output file ./caddy.log
		level INFO
	}
}

# Optional: HTTP on port 8000 (also no root) redirects to HTTPS
:8000 {
	redir https://{host}:8443{uri} permanent
}
