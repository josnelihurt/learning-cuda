syntax = "proto3";

package cuda_learning;

import "common.proto";
import "google/api/annotations.proto";

option go_package = "github.com/jrb/cuda-learning/proto/gen";

message StartSessionRequest {
  string session_id = 1 [json_name = "session_id"];
  string sdp_offer = 3 [json_name = "sdp_offer"];
  TraceContext trace_context = 5 [json_name = "trace_context"];
}

message StartSessionResponse {
  string session_id = 1 [json_name = "session_id"];
  string sdp_answer = 3 [json_name = "sdp_answer"];
  TraceContext trace_context = 5 [json_name = "trace_context"];
}

message IceCandidate {
  string candidate = 1 [json_name = "candidate"];
  string sdp_mid = 3 [json_name = "sdp_mid"];
  int32 sdp_mline_index = 5 [json_name = "sdp_mline_index"];
}

message SendIceCandidateRequest {
  string session_id = 1 [json_name = "session_id"];
  IceCandidate candidate = 3 [json_name = "candidate"];
  TraceContext trace_context = 5 [json_name = "trace_context"];
}

message SendIceCandidateResponse {
  string session_id = 1 [json_name = "session_id"];
  bool accepted = 3 [json_name = "accepted"];
  string message = 5 [json_name = "message"];
  TraceContext trace_context = 7 [json_name = "trace_context"];
}

message CloseSessionRequest {
  string session_id = 1 [json_name = "session_id"];
  TraceContext trace_context = 3 [json_name = "trace_context"];
}

message CloseSessionResponse {
  string session_id = 1 [json_name = "session_id"];
  bool closed = 3 [json_name = "closed"];
  TraceContext trace_context = 5 [json_name = "trace_context"];
}

message KeepAlive {
  int64 timestamp = 1 [json_name = "timestamp"];
}

message SignalingMessage {
  oneof message {
    StartSessionRequest start_session = 1 [json_name = "start_session"];
    StartSessionResponse start_session_response = 2 [json_name = "start_session_response"];
    SendIceCandidateRequest ice_candidate = 3 [json_name = "ice_candidate"];
    SendIceCandidateResponse ice_candidate_response = 4 [json_name = "ice_candidate_response"];
    CloseSessionRequest close_session = 5 [json_name = "close_session"];
    CloseSessionResponse close_session_response = 6 [json_name = "close_session_response"];
    KeepAlive keep_alive = 7 [json_name = "keep_alive"];
  }
}

service WebRTCSignalingService {
  rpc SignalingStream(stream SignalingMessage) returns (stream SignalingMessage);
}


